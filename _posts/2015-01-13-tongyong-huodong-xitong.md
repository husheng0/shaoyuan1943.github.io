---
layout: post
title: "萌仙系列之通用活动系统的设计与实现"
categories: cocos2d-x
---

活动系统对于一个游戏而言是异常重要的，活动不仅能够吸引玩家营造游戏内热闹的气氛，在一定程度上也能够提升收入（比如充值活动）。游戏活动是游戏在运营的过程中，临时、短期或者间隙地将一些内容加入到游戏中，丰富游戏的玩点和内容，刺激玩家参与其中，从而提高游戏的在线率以及人气等。这种内容一般具有刺激消费的性质，这些内容的不固定性和不同游戏基础系统的表现方式也给游戏带入一些新鲜的元素。

但是活动是有很多类型的，比如充值类活动，闯关类活动，收集类活动等，而充值类活动可能又分为角色首次充值活动，角色累计充值活动等。萌仙以前的情况是，每当要开某种类型的活动时候，就需要程序配合去现场做一个，并不是成系统的做，而是在某些地方直接加上活动的逻辑。比如要开一个充值x2的活动，那么就是直接在充值逻辑之前加上充值x2的逻辑。

这种方式带来的问题是，每开一次活动都需要程序去修改代码从而实现活动逻辑，非常容易出错，而且代码也非常糟糕，所以需要一个由策划和运营去配置的活动系统，程序在完成了这个类型的活动之后交付给策划和运营即可。

萌仙内的活动是支持GM工具配置的，根据现有的情况，大致的流程如下：

GM工具-->中转服务器transit\_sever-->game server-->zone_center

然后将已开启的活动推送至每一个玩家，对于通用性，我们应该有足够的考量。  

某一类型的活动，可以将之抽象出来以各种字段来表述放置在lua的table表中，比如活动一般都会有一个标题（title），描述（description），详细规则信息（detail），还需要有一些额外的条件限制，还需要配置相应的奖励等，甚至还需要支持针对开服时间不同来配置不同的活动，明确上述需求之后，可以将活动大致抽象出来：  

``` lua
Data = 
{
	{
		title,
		description,
		details,
		startTime,
		endTime,
		isEnabled,
		timeType,
		payStart,
		payEnd,
		propertyCount
	}
};
```

以上面的充值类活动为例：startTime和andTime为活动的开始时间与结束时间，timeType决定startTime和endTime的时间类型：  
1. DateTime：说明为具体的日期时间。  
2. ServerOpenDays：说明以区服开服天数为准，startTime和endTime取值为相对区服的开服天数。  
3. AlwaysOpen：说明此活动不受时间限制，数据固定常开活动。  
4. payStart和payEnd决定充值区间，数据活动的规则部分。  
5. propertyCount决定该充值活动的返还倍率。  